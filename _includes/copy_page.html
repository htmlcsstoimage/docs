{% comment %}
  Copy Page Component
  Provides a dropdown to copy the page as markdown or view the raw markdown
{% endcomment %}

{% if site.gh_edit_repository and site.gh_edit_branch and page.path %}
  {% comment %} Extract repo path from full URL {% endcomment %}
  {% assign repo_parts = site.gh_edit_repository | split: "github.com/" %}
  {% assign repo_path = repo_parts[1] %}
  {% assign raw_url = "https://raw.githubusercontent.com/" | append: repo_path | append: "/" | append: site.gh_edit_branch | append: "/" | append: page.path %}
  {% assign view_url = site.gh_edit_repository | append: "/raw/refs/heads/" | append: site.gh_edit_branch | append: "/" | append: page.path %}
  {% assign current_page_url = site.url | append: page.url %}
  {% assign encoded_page_url = current_page_url | url_encode %}
  {% assign chatgpt_url = "https://chatgpt.com/?hints=search&prompt=Read+from+" | append: encoded_page_url | append: "+so+I+can+ask+questions+about+it." %}
  {% assign claude_url = "https://claude.ai/new?q=Read%20from%20" | append: encoded_page_url | append: "%20so%20I%20can%20ask%20questions%20about%20it." %}

<div class="copy-page-dropdown">
  <button class="copy-page-btn" id="copyPageBtn" aria-label="Copy page options" aria-expanded="false">
    <svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true">
      <path fill="currentColor" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path>
      <path fill="currentColor" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
    </svg>
    <span>Copy page</span>
    <svg class="dropdown-arrow" viewBox="0 0 16 16" width="12" height="12" aria-hidden="true">
      <path fill="currentColor" d="M4.427 7.427l3.396 3.396a.25.25 0 00.354 0l3.396-3.396A.25.25 0 0011.396 7H4.604a.25.25 0 00-.177.427z"></path>
    </svg>
  </button>
  
  <div class="copy-page-menu" id="copyPageMenu" role="menu" aria-hidden="true">
    <button class="copy-page-menu-item" id="copyMarkdownBtn" role="menuitem" data-raw-url="{{ raw_url }}">
      <svg viewBox="0 0 16 16" width="14" height="14" aria-hidden="true">
        <path fill="currentColor" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path>
        <path fill="currentColor" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
      </svg>
      <div class="menu-item-text">
        <div class="menu-item-title">Copy page</div>
        <div class="menu-item-subtitle">Copy page as Markdown for LLMs</div>
      </div>
    </button>
    
    <a class="copy-page-menu-item" href="{{ view_url }}" target="_blank" rel="noopener noreferrer" role="menuitem">
      <svg viewBox="0 0 16 16" width="14" height="14" aria-hidden="true">
        <path fill="currentColor" d="M1 2.75C1 1.784 1.784 1 2.75 1h10.5c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 13.25 15H2.75A1.75 1.75 0 0 1 1 13.25Zm1.75-.25a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h10.5a.25.25 0 0 0 .25-.25V2.75a.25.25 0 0 0-.25-.25ZM4.75 5h6.5a.75.75 0 0 1 0 1.5h-6.5a.75.75 0 0 1 0-1.5Zm0 3h6.5a.75.75 0 0 1 0 1.5h-6.5a.75.75 0 0 1 0-1.5Zm0 3h3.5a.75.75 0 0 1 0 1.5h-3.5a.75.75 0 0 1 0-1.5Z"></path>
      </svg>
      <div class="menu-item-text">
        <div class="menu-item-title">View as Markdown →</div>
        <div class="menu-item-subtitle">View this page as plain text</div>
      </div>
    </a>
    
    <a class="copy-page-menu-item" href="{{ chatgpt_url }}" target="_blank" rel="noopener noreferrer" role="menuitem">
      <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" class="ai-icon">
        <path fill="currentColor" d="M22.282 9.821a5.985 5.985 0 0 0-.516-4.91 6.046 6.046 0 0 0-6.51-2.9A6.065 6.065 0 0 0 4.981 4.18a5.985 5.985 0 0 0-3.998 2.9 6.046 6.046 0 0 0 .743 7.097 5.98 5.98 0 0 0 .51 4.911 6.051 6.051 0 0 0 6.515 2.9A5.985 5.985 0 0 0 13.26 24a6.056 6.056 0 0 0 5.772-4.206 5.99 5.99 0 0 0 3.997-2.9 6.056 6.056 0 0 0-.747-7.073zM13.26 22.43a4.476 4.476 0 0 1-2.876-1.04l.141-.081 4.779-2.758a.795.795 0 0 0 .392-.681v-6.737l2.02 1.168a.071.071 0 0 1 .038.052v5.583a4.504 4.504 0 0 1-4.494 4.494zM3.6 18.304a4.47 4.47 0 0 1-.535-3.014l.142.085 4.783 2.759a.771.771 0 0 0 .78 0l5.843-3.369v2.332a.08.08 0 0 1-.033.062L9.74 19.95a4.5 4.5 0 0 1-6.14-1.646zM2.34 7.896a4.485 4.485 0 0 1 2.366-1.973V11.6a.766.766 0 0 0 .388.676l5.815 3.355-2.02 1.168a.076.076 0 0 1-.071 0l-4.83-2.786A4.504 4.504 0 0 1 2.34 7.872zm16.597 3.855l-5.833-3.387L15.119 7.2a.076.076 0 0 1 .071 0l4.83 2.791a4.494 4.494 0 0 1-.676 8.105v-5.678a.79.79 0 0 0-.407-.667zm2.01-3.023l-.141-.085-4.774-2.782a.776.776 0 0 0-.785 0L9.409 9.23V6.897a.066.066 0 0 1 .028-.061l4.83-2.787a4.5 4.5 0 0 1 6.68 4.66zm-12.64 4.135l-2.02-1.164a.08.08 0 0 1-.038-.057V6.075a4.5 4.5 0 0 1 7.375-3.453l-.142.08L8.704 5.46a.795.795 0 0 0-.393.681zm1.097-2.365l2.602-1.5 2.607 1.5v2.999l-2.597 1.5-2.607-1.5z"/>
      </svg>
      <div class="menu-item-text">
        <div class="menu-item-title">Open in ChatGPT →</div>
        <div class="menu-item-subtitle">Ask questions about this page</div>
      </div>
    </a>
    
    <a class="copy-page-menu-item" href="{{ claude_url }}" target="_blank" rel="noopener noreferrer" role="menuitem">
      <svg fill="currentColor" fill-rule="evenodd" viewBox="0 0 256 257" width="16" height="16" aria-hidden="true" class="ai-icon" preserveAspectRatio="xMidYMid">
        <path d="m50.228 170.321 50.357-28.257.843-2.463-.843-1.361h-2.462l-8.426-.518-28.775-.778-24.952-1.037-24.175-1.296-6.092-1.297L0 125.796l.583-3.759 5.12-3.434 7.324.648 16.202 1.101 24.304 1.685 17.629 1.037 26.118 2.722h4.148l.583-1.685-1.426-1.037-1.101-1.037-25.147-17.045-27.22-18.017-14.258-10.37-7.713-5.25-3.888-4.925-1.685-10.758 7-7.713 9.397.649 2.398.648 9.527 7.323 20.35 15.75L94.817 91.9l3.889 3.24 1.555-1.102.195-.777-1.75-2.917-14.453-26.118-15.425-26.572-6.87-11.018-1.814-6.61c-.648-2.723-1.102-4.991-1.102-7.778l7.972-10.823L71.42 0 82.05 1.426l4.472 3.888 6.61 15.101 10.694 23.786 16.591 32.34 4.861 9.592 2.592 8.879.973 2.722h1.685v-1.556l1.36-18.211 2.528-22.36 2.463-28.776.843-8.1 4.018-9.722 7.971-5.25 6.222 2.981 5.12 7.324-.713 4.73-3.046 19.768-5.962 30.98-3.889 20.739h2.268l2.593-2.593 10.499-13.934 17.628-22.036 7.778-8.749 9.073-9.657 5.833-4.601h11.018l8.1 12.055-3.628 12.443-11.342 14.388-9.398 12.184-13.48 18.147-8.426 14.518.778 1.166 2.01-.194 30.46-6.481 16.462-2.982 19.637-3.37 8.88 4.148.971 4.213-3.5 8.62-20.998 5.184-24.628 4.926-36.682 8.685-.454.324.519.648 16.526 1.555 7.065.389h17.304l32.21 2.398 8.426 5.574 5.055 6.805-.843 5.184-12.962 6.611-17.498-4.148-40.83-9.721-14-3.5h-1.944v1.167l11.666 11.406 21.387 19.314 26.767 24.887 1.36 6.157-3.434 4.86-3.63-.518-23.526-17.693-9.073-7.972-20.545-17.304h-1.36v1.814l4.73 6.935 25.017 37.59 1.296 11.536-1.814 3.76-6.481 2.268-7.13-1.297-14.647-20.544-15.1-23.138-12.185-20.739-1.49.843-7.194 77.448-3.37 3.953-7.778 2.981-6.48-4.925-3.436-7.972 3.435-15.749 4.148-20.544 3.37-16.333 3.046-20.285 1.815-6.74-.13-.454-1.49.194-15.295 20.999-23.267 31.433-18.406 19.702-4.407 1.75-7.648-3.954.713-7.064 4.277-6.286 25.47-32.405 15.36-20.092 9.917-11.6-.065-1.686h-.583L44.07 198.125l-12.055 1.555-5.185-4.86.648-7.972 2.463-2.593 20.35-13.999-.064.065Z"></path>
      </svg>
      <div class="menu-item-text">
        <div class="menu-item-title">Open in Claude →</div>
        <div class="menu-item-subtitle">Ask questions about this page</div>
      </div>
    </a>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  var copyPageBtn = document.getElementById('copyPageBtn');
  var copyPageMenu = document.getElementById('copyPageMenu');
  var copyMarkdownBtn = document.getElementById('copyMarkdownBtn');
  
  if (!copyPageBtn || !copyPageMenu || !copyMarkdownBtn) {
    return;
  }
  
  /* Toggle dropdown */
  copyPageBtn.addEventListener('click', function(e) {
    e.preventDefault();
    e.stopPropagation();
    
    var isExpanded = copyPageBtn.getAttribute('aria-expanded') === 'true';
    copyPageBtn.setAttribute('aria-expanded', String(!isExpanded));
    copyPageMenu.setAttribute('aria-hidden', String(isExpanded));
    copyPageMenu.classList.toggle('show');
  });
  
  /* Close dropdown when clicking outside */
  document.addEventListener('click', function(e) {
    if (!copyPageBtn.contains(e.target) && !copyPageMenu.contains(e.target)) {
      copyPageBtn.setAttribute('aria-expanded', 'false');
      copyPageMenu.setAttribute('aria-hidden', 'true');
      copyPageMenu.classList.remove('show');
    }
  });
  
  /* Copy markdown to clipboard */
  copyMarkdownBtn.addEventListener('click', function(e) {
    e.preventDefault();
    e.stopPropagation();
    
    var rawUrl = this.getAttribute('data-raw-url');
    var titleElement = copyMarkdownBtn.querySelector('.menu-item-title');
    var originalText = titleElement.textContent;
    
    titleElement.textContent = 'Loading...';
    
    fetch(rawUrl)
      .then(function(response) {
        if (!response.ok) throw new Error('Failed to fetch markdown');
        return response.text();
      })
      .then(function(markdown) {
        return navigator.clipboard.writeText(markdown);
      })
      .then(function() {
        titleElement.textContent = 'Copied!';
        setTimeout(function() {
          titleElement.textContent = originalText;
          copyPageBtn.setAttribute('aria-expanded', 'false');
          copyPageMenu.setAttribute('aria-hidden', 'true');
          copyPageMenu.classList.remove('show');
        }, 1500);
      })
      .catch(function(err) {
        console.error('Error copying markdown:', err);
        titleElement.textContent = 'Error!';
        setTimeout(function() {
          titleElement.textContent = originalText;
        }, 2000);
      });
  });
  
  /* Keyboard navigation */
  copyPageBtn.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      copyPageBtn.setAttribute('aria-expanded', 'false');
      copyPageMenu.setAttribute('aria-hidden', 'true');
      copyPageMenu.classList.remove('show');
    }
  });
});
</script>
{% endif %}

